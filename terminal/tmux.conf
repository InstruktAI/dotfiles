# Prefix: C-a
set -g prefix C-a
unbind C-b
bind C-a send-prefix

set -g base-index 1
setw -g pane-base-index 1
set -g mouse on
set -g history-limit 50000
setw -g mode-keys vi
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",xterm-256color:Tc"
set -s escape-time 0

bind r source-file ~/.tmux.conf \; display "Reloaded"
bind R run-shell 'session="#{session_name}"; cmd=$(ps -o args= -p #{pane_pid} 2>/dev/null); if echo "$cmd" | grep -q "tmux.*attach.*-t"; then inner=$(echo "$cmd" | sed -n "s/.*-t *\\([^ ]*\\).*/\\1/p"); [ -n "$inner" ] && session="$inner"; fi; curl -s -X POST --unix-socket /tmp/teleclaude-api.sock "http://localhost/sessions/tmux/$session/agent-restart" >/dev/null 2>&1 && tmux display-message "Agent restarting ($session)..." || tmux display-message "Restart failed ($session)"'
bind v split-window -h -c "#{pane_current_path}"
bind s split-window -v -c "#{pane_current_path}"
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-pipe-and-cancel "pbcopy"

set -g pane-border-indicators off
set -g focus-events on

# Focus hook for inner session dimming (tc_tui only)
set-hook -g after-select-pane 'if -F "#{==:#{session_name},tc_tui}" "run-shell \"~/.local/bin/appearance focus-pane #{pane_pid}\""'

# Generate and load theme
run-shell "~/.local/bin/appearance tmux-theme"
source-file /tmp/tmux-theme.conf
